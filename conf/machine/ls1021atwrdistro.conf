MACHINE="ls1021atwr"
require conf/machine/ls1021atwr.conf

require conf/machine/include/ubuntubasics.inc

APTGET_TARGET_ARCH:ls1021atwr = "armhf"
UBUNTU_TARGET_ARCH:ls1021atwr = "armhf"

require conf/machine/include/layerscape-composite-memory-map.inc
HOSTTOOLS_NONFATAL:append = " bc"
BOOT_TYPE = "sd nor qspi"
BOOTLOADER_TYPE = "uboot"

export COMPOSITE_IMG1_FILE_sd    = "u-boot.bin-sdcard-ifc"
export COMPOSITE_IMG1_FILE_sd_sec = "u-boot.bin-sdcard-ifc-secure-boot"

export COMPOSITE_IMG1_FILE_nor = "rcw/ls1021atwr/SSR_PNS_30/rcw_1200.bin"
export COMPOSITE_IMG1_FILE_nor_sec = "rcw/ls1021atwr/SSR_PNS_30/rcw_1200_sben.bin"
export COMPOSITE_IMG1_FILE_qspi     = "rcw/ls1021atwr/SSR_PNS_30/rcw_1200_qspiboot.bin.swapped"
export COMPOSITE_IMG2_FILE_nor     = "u-boot.bin-nor"
export COMPOSITE_IMG2_FILE_nor_sec = "u-boot.bin-secure-boot"
export COMPOSITE_IMG2_FILE_qspi = "u-boot.bin-qspi"
export COMPOSITE_IMG4_FILE_sd_sec = "secboot_hdrs/secboot_hdrs_sdboot.bin"
export COMPOSITE_IMG4_FILE_nor_sec = "secboot_hdrs/secboot_hdrs_norboot.bin"
export COMPOSITE_IMG8_FILE         = "boot/iram_Type_A_LS1021a_r1.0.bin"
export COMPOSITE_IMG14_FILE         = "ls1021a-twr.dtb"

distro_boot_script ?= "\
  env exists dtb || setenv dtb ls1021a-twr.dtb; \
  env exists kernel_image || setenv kernel_image Image; \
  env exists devpart_boot || setenv devpart_boot 1; \
  env exists devpart_root || setenv devpart_root 4; \
  part uuid \$devtype \$devnum:\$devpart_root partuuidr; \
  setenv bootargs console=ttyS0,115200 earlycon=uart8250,mmio,0x21c0500 root=PARTUUID=\$partuuidr rw rootwait \$othbootargs; \
  load \$devtype \$devnum:\$devpart_root \$kernel_addr_r boot/\$kernel_image; \
  load \$devtype \$devnum:\$devpart_root \$fdt_addr_r boot/\$dtb; \
  env exists secureboot && echo validating secureboot && run secureboot_validate; \
  booti \$kernel_addr_r - \$fdt_addr_r"